<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Earn Zone - Full Control Admin Panel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f4f7f6; margin: 0; padding: 20px; color: #333; }
        .container { max-width: 1200px; margin: auto; display: none; }
        .panel { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        h1, h2 { color: #1a2530; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px; }
        label { display: block; margin-bottom: 5px; font-weight: 500; color: #555; }
        input, textarea, select { width: 100%; padding: 10px; margin-bottom: 15px; border-radius: 4px; border: 1px solid #ddd; box-sizing: border-box; font-size: 1rem; }
        button { background-color: #4A90E2; color: white; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer; font-size: 1rem; transition: background-color 0.2s; }
        button:hover { background-color: #357ABD; }
        table { width: 100%; border-collapse: collapse; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #ddd; vertical-align: middle; }
        th { background-color: #f9f9f9; }
        .btn-approve { background-color: #50E3C2; } .btn-approve:hover { background-color: #40b59b; }
        .btn-reject { background-color: #F5A623; } .btn-reject:hover { background-color: #d8911e; }
        .btn-delete { background-color: #e74c3c; } .btn-delete:hover { background-color: #c0392b; }
        #login-container { max-width: 400px; margin: 100px auto; padding: 30px; background: white; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center;}
        #login-container h1 { margin-bottom: 20px; }
        #login-error { color: #e74c3c; margin-top: 10px; min-height: 20px;}
        #logout-button { position: fixed; top: 20px; right: 20px; background-color: #e74c3c; z-index: 100; }
        #logout-button:hover { background-color: #c0392b; }
    </style>
</head>
<body>
    <div id="login-container">
        <h1>Admin Login</h1>
        <input type="email" id="login-email" placeholder="Email"><input type="password" id="login-password" placeholder="Password">
        <button onclick="handleLogin()">Login</button><p id="login-error"></p>
    </div>
    <div class="container" id="admin-dashboard">
        <button id="logout-button" onclick="handleLogout()">Logout</button>
        <h1>Earn Zone - Admin Panel</h1>
        <div class="panel">
            <h2>Global Settings & Notices</h2>
            <div class="grid-2">
                <div>
                    <h4>Settings</h4>
                    <label>Daily Bonus Reward</label><input type="number" id="daily-bonus-reward">
                    <label>Referrer Bonus (Points for inviter)</label><input type="number" id="referrer-bonus">
                    <label>Referee Bonus (Points for new user)</label><input type="number" id="referee-bonus">
                    <label>Click Counter Rule</label><input type="number" id="click-counter-rule">
                    <label>VPN Required</label><select id="vpn-required"><option value="true">Yes</option><option value="false">No</option></select>
                </div>
                <div>
                    <h4>Notices</h4>
                    <label>Home Notice</label><textarea id="home-notice" rows="2"></textarea>
                    <label>Referral Notice</label><textarea id="referral-notice" rows="2"></textarea>
                    <label>Withdraw Notice</label><textarea id="withdraw-notice" rows="2"></textarea>
                    <label>Task Notice</label><textarea id="task-notice" rows="2"></textarea>
                </div>
            </div>
            <button onclick="saveAppSettings()">Save All Settings & Notices</button>
        </div>
        <div class="panel">
            <h2>Manage Tasks</h2>
            <table id="tasks-table"><thead><tr><th>Network</th><th>Zone ID</th><th>Reward</th><th>Enabled</th><th>Actions</th></tr></thead><tbody></tbody></table>
            <h3>Add/Edit Task</h3><input type="hidden" id="task-id">
            <div class="grid-2">
                <div><label>Ad Network</label><select id="task-network"><option>Monetag</option><option>Gigapub</option><option>AdeExora</option><option>AdeExtra</option></select><label>Zone ID</label><input type="text" id="task-zoneid"></div>
                <div><label>Reward</label><input type="number" id="task-reward"><label>Enabled</label><select id="task-enabled"><option value="true">Yes</option><option value="false">No</option></select></div>
            </div>
            <button onclick="saveTask()">Save Task</button><button onclick="clearForm('task')">New Task</button>
        </div>
        <div class="grid-2">
            <div class="panel">
                <h2>Withdraw Methods</h2>
                <table id="methods-table"><thead><tr><th>Name</th><th>Logo URL</th><th>Actions</th></tr></thead><tbody></tbody></table>
                <h3>Add/Edit Method</h3><input type="hidden" id="method-id"><label>Name</label><input type="text" id="method-name"><label>Logo URL</label><input type="text" id="method-logo"><button onclick="saveWithdrawMethod()">Save Method</button><button onclick="clearForm('method')">New Method</button>
            </div>
            <div class="panel">
                <h2>Bonus Channels</h2>
                <table id="bonuses-table"><thead><tr><th>Name</th><th>Reward</th><th>Enabled</th><th>Actions</th></tr></thead><tbody></tbody></table>
                <h3>Add/Edit Bonus</h3><input type="hidden" id="bonus-id"><label>Name</label><input type="text" id="bonus-name"><label>Link</label><input type="text" id="bonus-link"><label>Reward</label><input type="number" id="bonus-reward"><label>Enabled</label><select id="bonus-enabled"><option value="true">Yes</option><option value="false">No</option></select><button onclick="saveBonusChannel()">Save Bonus</button><button onclick="clearForm('bonus')">New Bonus</button>
            </div>
        </div>
        <div class="panel">
            <h2>Withdrawal Requests</h2>
            <table id="withdraw-requests-table"><thead><tr><th>User</th><th>Amount</th><th>Method</th><th>Account</th><th>Timestamp</th><th>Actions</th></tr></thead><tbody></tbody></table>
        </div>
    </div>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCRnFOockStuQ6z3AU2dQ9fzZ6Tt_bUDL4",
            authDomain: "earn-zone-a6dce.firebaseapp.com",
            databaseURL: "https://earn-zone-a6dce-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "earn-zone-a6dce",
            storageBucket: "earn-zone-a6dce.appspot.com",
            messagingSenderId: "470563695372",
            appId: "1:470563695372:web:323d2941c316cef0a4b729"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        const loginContainer = document.getElementById('login-container');
        const adminDashboard = document.getElementById('admin-dashboard');
        auth.onAuthStateChanged(user => { if (user) { loginContainer.style.display = 'none'; adminDashboard.style.display = 'block'; loadAdminData(); } else { loginContainer.style.display = 'block'; adminDashboard.style.display = 'none'; } });
        function handleLogin() { const email = document.getElementById('login-email').value; const password = document.getElementById('login-password').value; auth.signInWithEmailAndPassword(email, password).catch(error => document.getElementById('login-error').textContent = error.message); }
        function handleLogout() { auth.signOut(); }
        function loadAdminData() {
            db.ref('admin').on('value', snap => {
                const adminData = snap.val() || {};
                const settings = adminData.settings || {}; const notices = adminData.notices || {}; const tasks = adminData.tasks || {}; const methods = adminData.withdrawMethods || {}; const bonuses = adminData.bonusChannels || {};
                document.getElementById('daily-bonus-reward').value = settings.dailyBonus?.reward || '';
                document.getElementById('referrer-bonus').value = settings.referralBonus?.referrer || '';
                document.getElementById('referee-bonus').value = settings.referralBonus?.referee || '';
                document.getElementById('click-counter-rule').value = settings.clickCounterRule || '';
                document.getElementById('vpn-required').value = settings.vpnRequired || false;
                document.getElementById('home-notice').value = notices.home || '';
                document.getElementById('referral-notice').value = notices.referral || '';
                document.getElementById('withdraw-notice').value = notices.withdraw || '';
                document.getElementById('task-notice').value = notices.tasks || '';
                populateTable('tasks-table', tasks, (id, item) => `<td>${item.network}</td><td>${item.zoneId}</td><td>${item.reward}</td><td>${item.enabled}</td>`, 'task');
                populateTable('methods-table', methods, (id, item) => `<td>${item.name}</td><td>${item.logoUrl}</td>`, 'method');
                populateTable('bonuses-table', bonuses, (id, item) => `<td>${item.name}</td><td>${item.reward}</td><td>${item.enabled}</td>`, 'bonus');
            });
            db.ref('withdrawRequests').orderByChild('status').equalTo('pending').on('value', snap => {
                const requests = snap.val() || {}; const tableBody = document.querySelector('#withdraw-requests-table tbody'); tableBody.innerHTML = '';
                Object.entries(requests).forEach(([id, req]) => { const date = new Date(req.timestamp).toLocaleString(); tableBody.innerHTML += `<tr><td>${req.userName}<br><small>${req.userId}</small></td><td>${req.amount}</td><td>${req.method}</td><td>${req.account}</td><td>${date}</td><td><button class="btn-approve" onclick="updateWithdrawStatus('${id}', 'approved')">Approve</button><button class="btn-reject" onclick="updateWithdrawStatus('${id}', 'rejected', ${req.amount}, '${req.userId}')">Reject</button></td></tr>`; });
            });
        }
        function populateTable(tableId, data, rowBuilder, type) { const tableBody = document.querySelector(`#${tableId} tbody`); tableBody.innerHTML = ''; Object.entries(data).forEach(([id, item]) => { tableBody.innerHTML += `<tr>${rowBuilder(id, item)}<td><button onclick="editItem('${type}', '${id}')">Edit</button><button class="btn-delete" onclick="deleteItem('admin/${type === 'method' ? 'withdrawMethods' : type === 'bonus' ? 'bonusChannels' : 'tasks' }/${id}')">Delete</button></td></tr>`; }); }
        function saveAppSettings() { const updates = { '/admin/settings/dailyBonus/reward': parseInt(document.getElementById('daily-bonus-reward').value) || 0, '/admin/settings/referralBonus/referrer': parseInt(document.getElementById('referrer-bonus').value) || 0, '/admin/settings/referralBonus/referee': parseInt(document.getElementById('referee-bonus').value) || 0, '/admin/settings/clickCounterRule': parseInt(document.getElementById('click-counter-rule').value) || 0, '/admin/settings/vpnRequired': document.getElementById('vpn-required').value === 'true', '/admin/notices/home': document.getElementById('home-notice').value, '/admin/notices/referral': document.getElementById('referral-notice').value, '/admin/notices/withdraw': document.getElementById('withdraw-notice').value, '/admin/notices/tasks': document.getElementById('task-notice').value, }; db.ref().update(updates).then(() => alert('Settings saved!')); }
        function saveData(type, path, data) { let id = document.getElementById(`${type}-id`).value; if (!id) id = db.ref(path).push().key; db.ref(`${path}/${id}`).set(data).then(() => { alert(`${type.charAt(0).toUpperCase() + type.slice(1)} saved!`); clearForm(type); }); }
        function saveTask() { const data = { network: document.getElementById('task-network').value, zoneId: document.getElementById('task-zoneid').value, reward: parseInt(document.getElementById('task-reward').value) || 0, enabled: document.getElementById('task-enabled').value === 'true' }; saveData('task', 'admin/tasks', data); }
        function saveWithdrawMethod() { const data = { name: document.getElementById('method-name').value, logoUrl: document.getElementById('method-logo').value }; saveData('method', 'admin/withdrawMethods', data); }
        function saveBonusChannel() { const data = { name: document.getElementById('bonus-name').value, link: document.getElementById('bonus-link').value, reward: parseInt(document.getElementById('bonus-reward').value) || 0, enabled: document.getElementById('bonus-enabled').value === 'true' }; saveData('bonus', 'admin/bonusChannels', data); }
        function editItem(type, id) { const path = `admin/${type === 'method' ? 'withdrawMethods' : type === 'bonus' ? 'bonusChannels' : 'tasks' }/${id}`; db.ref(path).once('value', snap => { const item = snap.val(); document.getElementById(`${type}-id`).value = id; if (type === 'task') { document.getElementById('task-network').value = item.network; document.getElementById('task-zoneid').value = item.zoneId; document.getElementById('task-reward').value = item.reward; document.getElementById('task-enabled').value = item.enabled; } else if (type === 'method') { document.getElementById('method-name').value = item.name; document.getElementById('method-logo').value = item.logoUrl; } else if (type === 'bonus') { document.getElementById('bonus-name').value = item.name; document.getElementById('bonus-link').value = item.link; document.getElementById('bonus-reward').value = item.reward; document.getElementById('bonus-enabled').value = item.enabled; } }); }
        function deleteItem(path) { if (confirm('Are you sure you want to delete this item?')) { db.ref(path).remove().then(() => alert('Item deleted.')); } }
        function clearForm(type) { const formIds = { 'task': ['task-id', 'task-zoneid', 'task-reward'], 'method': ['method-id', 'method-name', 'method-logo'], 'bonus': ['bonus-id', 'bonus-name', 'bonus-link', 'bonus-reward'] }; formIds[type].forEach(id => document.getElementById(id).value = ''); }
        function updateWithdrawStatus(requestId, status, amount = 0, userId = '') { const updates = { [`/withdrawRequests/${requestId}/status`]: status }; if (status === 'rejected' && amount > 0 && userId) { updates[`/users/${userId}/points`] = firebase.database.ServerValue.increment(amount); } db.ref().update(updates).then(() => alert(`Request has been ${status}.`)); }
    </script>
</body>
</html>
