<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EarnZone - ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ü‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶®</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap');
        
        * {
            font-family: 'Hind Siliguri', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .login-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 2rem;
            width: 90%;
            max-width: 400px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-google {
            background: #DB4437;
            transition: all 0.3s;
        }
        
        .btn-google:hover {
            background: #C53929;
        }
        
        .error-message {
            background: #f56565;
            color: white;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            display: none;
        }
    </style>
</head>
<body>
    <!-- ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ -->
    <div id="loginContainer" class="login-container">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-white mb-2">üéØ EarnZone</h1>
            <p class="text-gray-300">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ö‡¶∞‡ßç‡¶ú‡¶® ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
        </div>

        <!-- Error Message -->
        <div id="errorMessage" class="error-message"></div>

        <!-- Google ‡¶≤‡¶ó‡¶á‡¶® -->
        <div class="mb-6">
            <h2 class="text-xl font-semibold text-white mb-4">Google ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶≤‡¶ó‡¶á‡¶®</h2>
            <button onclick="handleGoogleLogin()" class="w-full btn-google text-white p-3 rounded-lg font-semibold mb-3">
                <i class="fab fa-google mr-2"></i> Google ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶≤‡¶ó‡¶á‡¶®
            </button>
            <p class="text-gray-400 text-sm">Google ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</p>
        </div>

        <!-- Divider -->
        <div class="flex items-center mb-6">
            <div class="flex-grow border-t border-gray-600"></div>
            <span class="mx-4 text-gray-400">‡¶Ö‡¶•‡¶¨‡¶æ</span>
            <div class="flex-grow border-t border-gray-600"></div>
        </div>

        <!-- ‡¶á‡¶Æ‡ßá‡¶á‡¶≤/‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≤‡¶ó‡¶á‡¶® -->
        <div class="mb-6">
            <h2 class="text-xl font-semibold text-white mb-4">‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶≤‡¶ó‡¶á‡¶®</h2>
            <input type="email" id="loginEmail" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤" class="w-full p-3 rounded-lg mb-3 bg-gray-800 text-white border border-gray-700">
            <input type="password" id="loginPassword" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°" class="w-full p-3 rounded-lg mb-3 bg-gray-800 text-white border border-gray-700">
            <button onclick="handleEmailLogin()" class="w-full bg-blue-600 text-white p-3 rounded-lg font-semibold hover:bg-blue-700 transition">
                ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®
            </button>
            <p class="text-gray-400 text-sm mt-3 text-center">
                ‡¶®‡¶§‡ßÅ‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞? <a href="#" onclick="showRegisterForm()" class="text-blue-400">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</a>
            </p>
        </div>

        <!-- ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶´‡¶∞‡ßç‡¶Æ (Initially hidden) -->
        <div id="registerForm" class="hidden">
            <h2 class="text-xl font-semibold text-white mb-4">‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
            <input type="email" id="registerEmail" placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤" class="w-full p-3 rounded-lg mb-3 bg-gray-800 text-white border border-gray-700">
            <input type="password" id="registerPassword" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° (Ëá≥Â∞ë ‡ß¨ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞)" class="w-full p-3 rounded-lg mb-3 bg-gray-800 text-white border border-gray-700">
            <input type="password" id="confirmPassword" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®" class="w-full p-3 rounded-lg mb-3 bg-gray-800 text-white border border-gray-700">
            <button onclick="handleRegister()" class="w-full bg-green-600 text-white p-3 rounded-lg font-semibold hover:bg-green-700 transition">
                ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®
            </button>
            <p class="text-gray-400 text-sm mt-3 text-center">
                ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá‡¶á ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Ü‡¶õ‡ßá? <a href="#" onclick="showLoginForm()" class="text-blue-400">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</a>
            </p>
        </div>
    </div>

    <!-- ‡¶Æ‡ßá‡¶á‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü (Initially hidden) -->
    <div id="appContent" class="hidden">
        <!-- ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá‡¶∞ ‡¶Æ‡ßÇ‡¶≤ ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü -->
        <div class="p-4 text-center">
            <h1 class="text-2xl font-bold text-white">‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡¶´‡¶≤!</h1>
            <p class="text-gray-300">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá‡¶∞ ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
        </div>
    </div>

    <script>
        // ==================== FIREBASE CONFIGURATION ====================
        const firebaseConfig = {
            apiKey: "AIzaSyCRnFOockStuQ6z3AU2dQ9fzZ6Tt_bUDL4",
            authDomain: "earn-zone-a6dce.firebaseapp.com",
            databaseURL: "https://earn-zone-a6dce-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "earn-zone-a6dce",
            storageBucket: "earn-zone-a6dce.firebasestorage.app",
            messagingSenderId: "470563695372",
            appId: "1:470563695372:web:323d2941c316cef0a4b729"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // ==================== AUTHENTICATION FUNCTIONS ====================
        
        // Google ‡¶≤‡¶ó‡¶á‡¶®
        async function handleGoogleLogin() {
            try {
                showLoading('Google ‡¶≤‡¶ó‡¶á‡¶® ‡¶π‡¶ö‡ßç‡¶õ‡ßá...');
                const provider = new firebase.auth.GoogleAuthProvider();
                const result = await auth.signInWithPopup(provider);
                await processUserData(result.user, true);
                hideLoginForm();
            } catch (error) {
                showError('Google ‡¶≤‡¶ó‡¶á‡¶® Error: ' + error.message);
            }
        }

        // ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶≤‡¶ó‡¶á‡¶®
        async function handleEmailLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showError('‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶è‡¶¨‡¶Ç ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®');
                return;
            }

            try {
                showLoading('‡¶≤‡¶ó‡¶á‡¶® ‡¶π‡¶ö‡ßç‡¶õ‡ßá...');
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                await processUserData(userCredential.user);
                hideLoginForm();
            } catch (error) {
                if (error.code === 'auth/user-not-found') {
                    showError('‡¶è‡¶á ‡¶á‡¶Æ‡ßá‡¶á‡¶≤‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡ßá‡¶á‡•§ ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                } else if (error.code === 'auth/wrong-password') {
                    showError('‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°');
                } else {
                    showError('‡¶≤‡¶ó‡¶á‡¶® Error: ' + error.message);
                }
            }
        }

        // ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞
        async function handleRegister() {
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!email || !password || !confirmPassword) {
                showError('‡¶∏‡¶¨ fields ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®');
                return;
            }

            if (password !== confirmPassword) {
                showError('‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° match ‡¶ï‡¶∞‡¶õ‡ßá ‡¶®‡¶æ');
                return;
            }

            if (password.length < 6) {
                showError('‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°Ëá≥Â∞ë ‡ß¨ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá');
                return;
            }

            try {
                showLoading('‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...');
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                await processUserData(userCredential.user, true);
                hideLoginForm();
                alert('üéâ ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤! ‡ßß‡ß¶‡ß¶ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡ßá‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡¶®!');
            } catch (error) {
                if (error.code === 'auth/email-already-in-use') {
                    showError('‡¶è‡¶á ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ already registered');
                } else {
                    showError('‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ Error: ' + error.message);
                }
            }
        }

        // ==================== USER DATA PROCESSING ====================
        async function processUserData(user, isNewUser = false) {
            try {
                const userRef = db.collection('users').doc(user.uid);
                
                if (isNewUser) {
                    // ‡¶®‡¶§‡ßÅ‡¶®Áî®Êà∑
                    await userRef.set({
                        email: user.email,
                        points: 100,
                        todayEarnings: 0,
                        completedTasks: 0,
                        totalEarnings: 0,
                        totalWithdrawn: 0,
                        totalReferrals: 0,
                        activeReferrals: 0,
                        referralPoints: 0,
                        referralCode: generateReferralCode(),
                        createdAt: new Date(),
                        lastSeen: new Date(),
                        banned: false
                    });
                } else {
                    // Existing user
                    await userRef.update({
                        last_seen: new Date()
                    });
                }
                
                return true;
            } catch (error) {
                console.error('User data processing error:', error);
                return false;
            }
        }

        // ==================== UI FUNCTIONS ====================
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => errorDiv.style.display = 'none', 5000);
        }

        function showLoading(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message + '...';
            errorDiv.style.display = 'block';
            errorDiv.style.background = '#4299e1';
        }

        function showRegisterForm() {
            document.getElementById('registerForm').classList.remove('hidden');
            document.querySelectorAll('div:not(#registerForm)').forEach(el => {
                if (el.id !== 'registerForm' && el.id !== 'errorMessage') {
                    el.style.display = 'none';
                }
            });
        }

        function showLoginForm() {
            document.getElementById('registerForm').classList.add('hidden');
            document.querySelectorAll('div:not(#registerForm)').forEach(el => {
                if (el.id !== 'registerForm' && el.id !== 'errorMessage') {
                    el.style.display = 'block';
                }
            });
        }

        function hideLoginForm() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('appContent').classList.remove('hidden');
        }

        function generateReferralCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 6; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        // ==================== INITIALIZE APP ====================
        auth.onAuthStateChanged(user => {
            if (user) {
                // User is signed in
                hideLoginForm();
                console.log('User logged in:', user.email);
            } else {
                // User is signed out
                document.getElementById('loginContainer').style.display = 'flex';
                document.getElementById('appContent').classList.add('hidden');
            }
        });

        console.log("EarnZone ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá...");
    </script>
</body>
</html>
